<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Trilingo</title><head>
</head>

	
    <style>
       
        @import url('https://fonts.googleapis.com/css2?family=Poetsen+One&display=swap');

        body {
            font-family: 'Arial', sans-serif;
            background-color: #FFF7F1;
        }

        h1 {
            font-family: 'Poetsen One';
            font-size: 30pt;
            font-weight: 800;
            color: #D20062;
	    line-height: 1;
        }

        h2, h3 {
            font-family: 'Arial';
            font-size: 12pt;
            font-weight: 200;
            color: #E78895;
	    line-height: 1.5;
        }

        h3 {
            margin-bottom: 20px; /* Adjusted margin */
            margin-left: 40px;
            margin-right: 40px;
            line-height: 1.5;
        }

        .footer-section {
            background-color: #D20062;
            padding-top: 25px;
	    	padding-bottom: 25px;
	   		 padding-left: 10px;
            padding-left: 10px;
            color: #B1B1B1;
            font-size: 8pt;
            text-align: center;
	    line-height: 1.5;
		margin-top: 40px;
        }

        button {
            font-family: 'Arial';
            background-color: #E78895;
            border: none;
            color: #FFF7F1;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            font-size: 18px;
            cursor: pointer;
            border-radius: 15px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        #uploadBox {
            border-radius: 0;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            width: 150px;
            height: 200px;
            background-color: white;
            margin: 0 auto;
        }

        #capturedImage {
        	max-width: 100%;
        	max-height: 100%;
    	}

        #result {
    		color: #E78895;
    		display: flex;
    		justify-content: center; /* Center the content horizontally */
    		background-color: white; /* Set background color to white */
	}

.result-column {
    flex: 1 1 auto; /* Allow flex items to grow and shrink equally */
    margin: 0 15px; /* Adjust margin to create gaps between columns */
    padding: 0;
    margin-bottom: 20px;
    max-width: calc((100% - 40px - 20px) / 3); /* Adjust maximum width considering gaps */
    box-sizing: border-box; /* Include padding and border in the element's total width */
    position: relative; /* Add relative positioning for pseudo-element */
}

.result-column:not(:last-child)::after {
    content: '';
    position: absolute;
    top: 0;
    right: -5px; /* Adjust position to overlay the gap */
    bottom: 0;
    width: 1px; /* Set the width of the vertical line */
    background-color: #D20062; /* Set the color of the vertical line */
}

.result-heading {
    font-family: 'Poetsen One';
    font-size: 14px;
    font-weight: 100;
    margin: 0;
    padding: 0;
    color: #D20062;
    line-height: 1;
    margin-top: 20px;
}

.result-text {
    font-family: 'Arial';
    font-size: 18px;
    color: black;
    font-weight: 600;
    line-height: 1.5;
    cursor: pointer;
}

        .action-button-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
	margin-bottom: 20px;
        }
    </style>

<body>
<div class="container">
    <h1>Trilingo</h1>
    <h3>Take a picture to find out what it is called in English, Malay, and Chinese!</h3>
    <div id="uploadBox">
        <div id="cameraBox"></div>
        <img id="capturedImage" src="" style="display: none;">
    </div>
    <div class="action-button-container">
        <input type="file" accept="image/*" capture="environment" id="fileInput" style="display: none;">
        <button id="onCameraButton">On Camera</button>
    </div>
    <div id="result" class="result-columns"></div>
</div>

<div class="footer-section">
    <div style="font-family: 'Poetsen One'; font-size: 16pt; font-weight: 800; color: white;">Trilingo</div>
    Trilingo is in the developmental phase.<br>Please share your thoughts with us at trilingotots@gmail.com.
</div>

<script>
    document.getElementById('onCameraButton').addEventListener('click', function() {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function(event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var imgUrl = e.target.result;
                var capturedImage = document.getElementById('capturedImage');
                capturedImage.src = imgUrl;
            	capturedImage.style.display = 'block';
            
            // Call the recognizeImage function with the image URL
            recognizeImage(imgUrl);
        };
        reader.readAsDataURL(file);
    }
});

    function recognizeImage(imgUrl) {
        fetch('https://vision.googleapis.com/v1/images:annotate?key=AIzaSyClrPxLer-VRuWIwtp_9v0xwCViUve5HMc', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                "requests": [
                    {
                        "image": {
                            "content": imgUrl.split(",")[1] // Extracting base64 data
                        },
                        "features": [
                            {
                                "type": "LABEL_DETECTION"
                            }
                        ]
                    }
                ]
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.responses && data.responses[0] && data.responses[0].labelAnnotations && data.responses[0].labelAnnotations.length > 0) {
                const labels = data.responses[0].labelAnnotations.map(annotation => annotation.description);
                const recognitionResult = {
                    English: labels[0], // Assuming the most prominent object is the first label
                    Malay: "", // Placeholder for Malay translation
                    Chinese: "" // Placeholder for Chinese translation
                };
                translateText(recognitionResult.English, 'en', 'ms').then(malayText => {
                    recognitionResult.Malay = malayText;
                    return translateText(recognitionResult.English, 'en', 'zh-CN');
                }).then(chineseText => {
                    recognitionResult.Chinese = chineseText;
                    return getPinyin(chineseText, 'zh-CN');
                }).then(pinyin => {
                    recognitionResult["Pinyin Tones"] = pinyin;
                    displayResult(recognitionResult);
                }).catch(error => {
                    console.error('Error translating text:', error);
                    // If translation fails, display English result only
                    displayResult(recognitionResult);
                });
            } else {
                const recognitionResult = {
                    English: "Try again",
                    Malay: "Cuba lagi",
                    Chinese: "再试一次"
                };
                displayResult(recognitionResult);
            }
        })
        .catch(error => {
            console.error('Error recognizing image:', error);
        });
    }

    function displayResult(recognitionResult) {
        clearResults();
        for (var language in recognitionResult) {
            var resultDiv = document.getElementById('result');
            var columnDiv = document.createElement('div');
            columnDiv.classList.add('result-column');

            var heading = document.createElement('h2');
            heading.classList.add('result-heading');
            heading.textContent = language + ":";

            var text = document.createElement('p');
            text.classList.add('result-text');
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.textContent = recognitionResult[language];
            text.appendChild(wordSpan);

            if (language === 'Chinese') {
                var pinyinSpan = document.createElement('span');
                pinyinSpan.classList.add('pinyin');
                pinyinSpan.textContent = recognitionResult["Pinyin Tones"];
                text.appendChild(document.createElement('br')); // Add line break
                text.appendChild(pinyinSpan);
                columnDiv.appendChild(heading);
                columnDiv.appendChild(text);
                resultDiv.appendChild(columnDiv);
            } else {
                columnDiv.appendChild(heading);
                columnDiv.appendChild(text);
                resultDiv.appendChild(columnDiv);
            }

            // Add event listener to read out the words
            text.addEventListener('click', function() {
                speakText(this.querySelector('.word').textContent, language === 'Malay' ? 'ms' : 'en-US');
                if (language === 'Chinese' && this.querySelector('.pinyin')) {
                    speakText(this.querySelector('.pinyin').textContent, 'zh-CN');
                }
            });
        }
    }

    function clearResults() {
        var resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';
    }

    async function translateText(text, sourceLanguage, targetLanguage) {
        const response = await fetch(`https://translation.googleapis.com/language/translate/v2?key=AIzaSyClrPxLer-VRuWIwtp_9v0xwCViUve5HMc&q=${encodeURIComponent(text)}&source=${sourceLanguage}&target=${targetLanguage}&format=text&model=base`, {
            method: 'POST'
        });
        const data = await response.json();
        if (data && data.data && data.data.translations && data.data.translations.length > 0) {
            return data.data.translations[0].translatedText;
        } else {
            throw new Error('Translation failed');
        }
    }

    async function getPinyin(chineseWord, sourceLanguage) {
        const response = await fetch(`https://translation.googleapis.com/language/translate/v2?key=AIzaSyClrPxLer-VRuWIwtp_9v0xwCViUve5HMc&q=${encodeURIComponent(chineseWord)}&source=${sourceLanguage}&target=${sourceLanguage}&format=text&model=base`, {
            method: 'POST'
        });
        const data = await response.json();
        if (data && data.data && data.data.translations && data.data.translations.length > 0) {
            return data.data.translations[0].translatedText;
        } else {
            throw new Error('Pinyin retrieval failed');
        }
    }

    function speakText(text, languageCode) {
        // Google Text-to-Speech API endpoint
        var ttsEndpoint = 'https://texttospeech.googleapis.com/v1/text:synthesize?key=AIzaSyDQUaEzdQy4i-5thYcP4OA5rzMfMYc5BMM';

        // Request body
        var requestBody = JSON.stringify({
            input: {
                text: text
            },
            voice: {
                languageCode: languageCode, // Language code for English (US), Malay, or Chinese
                ssmlGender: 'MALE' // You can adjust the gender as needed
            },
            audioConfig: {
                audioEncoding: 'MP3' // You can adjust the audio encoding type
            }
        });

        // Fetch request to Google TTS API
        fetch(ttsEndpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: requestBody
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data && data.audioContent) {
                // Decode base64 audio content
                var audioData = atob(data.audioContent);
                // Convert audio data to binary format
                var arrayBuffer = new ArrayBuffer(audioData.length);
                var uint8Array = new Uint8Array(arrayBuffer);
                for (var i = 0; i < audioData.length; i++) {
                    uint8Array[i] = audioData.charCodeAt(i);
                }
                // Create blob object from binary data
                var blob = new Blob([arrayBuffer], { type: 'audio/mpeg' });

                // Play the audio
                var audioElement = new Audio(URL.createObjectURL(blob));
                audioElement.play();
            } else {
                throw new Error('Audio content not found in response');
            }
        })
        .catch(error => {
            console.error('Error fetching audio:', error);
        });
    }
</script>

</body>
</html>

